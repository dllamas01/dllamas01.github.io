/*!
 * Title: Dev Portfolio Template (Enhanced)
 * Version: 2.0
 * Author: David Llamas
 * Description: Smooth scrolling, timeline builder,animations, and UI enhancements
 */

(function ($) {
    // Remove no-js for progressive enhancement
    $('html').removeClass('no-js');

    // Smooth scroll for anchor links
    $('header a').click(function (e) {
        const $this = $(this);
        if (!$this.hasClass('no-scroll')) {
            e.preventDefault();
            const target = $($this.attr('href')).offset().top;
            $('html, body').animate({ scrollTop: target }, 800);
            $('header, body').removeClass('active');
        }
    });

    // Scroll to top button
    $('#to-top').click(() => {
        $('html, body').animate({ scrollTop: 0 }, 500);
    });

    // Scroll from lead to next section
    $('#lead-down span').click(() => {
        const next = $('#lead').next().offset().top;
        $('html, body').animate({ scrollTop: next }, 500);
    });

    // Mobile menu toggle
    $('#mobile-menu-open').click(() => $('header, body').addClass('active'));
    $('#mobile-menu-close').click(() => $('header, body').removeClass('active'));

    // Show more projects
    $('#view-more-projects').click((e) => {
        e.preventDefault();
        $(e.target).fadeOut(300, () => {
            $('#more-projects').fadeIn(300);
        });
    });

    // Timeline builder
    $('#experience-timeline').each(function () {
        const $timeline = $(this);
        const $blocks = $timeline.children('div');

        $blocks.each(function () {
            $(this)
                .addClass('vtimeline-content')
                .wrap('<div class="vtimeline-point"><div class="vtimeline-block"></div></div>');
        });

        $timeline.find('.vtimeline-point').each(function () {
            $(this).prepend('<div class="vtimeline-icon"><i class="fa fa-map-marker"></i></div>');
        });

        $timeline.find('.vtimeline-content').each(function () {
            const date = $(this).data('date');
            if (date) {
                $(this).parent().prepend(`<span class="vtimeline-date">${date}</span>`);
            }
        });
    });

    // Animate elements on scroll
    const revealOnScroll = () => {
        $('[data-animate]').each(function () {
            const $el = $(this);
            const top = $el.offset().top;
            if ($(window).scrollTop() + $(window).height() > top + 100) {
                $el.addClass('animated');
            }
        });
    };

    $(window).on('scroll', function () {
        revealOnScroll();

        // Shrink header on scroll
        if ($(this).scrollTop() > 50) {
            $('header').addClass('scrolled');
        } else {
            $('header').removeClass('scrolled');
        }
    });

    revealOnScroll(); // Initial check

    // Highlight nav link on scroll
    const sections = $('section');
    const navLinks = $('header a');

    $(window).on('scroll', function () {
        let currentPos = $(this).scrollTop();
        sections.each(function () {
            const top = $(this).offset().top - 150;
            const bottom = top + $(this).outerHeight();

            if (currentPos >= top && currentPos <= bottom) {
                navLinks.removeClass('active');
                $('header').find(`[href="#${$(this).attr('id')}"]`).addClass('active');
            }
        });
    });

    // Typewriter effect with smoother speed and styling
    const typewriter = (el, text, speed = 75) => {
        let i = 0;
        const interval = setInterval(() => {
            if (i < text.length) {
                $(el).append(`<span>${text.charAt(i)}</span>`);
                i++;
            } else {
                clearInterval(interval);
            }
        }, speed);
    };

// Trigger typewriter on document ready
    $(document).ready(() => {
        // Typewriter effect
        if ($('#typewriter').length) {
            typewriter('#typewriter', 'Hi, I‚Äôm David Llamas Software Engineer');
        }
        // Dark Mode Toggle
        $('#dark-toggle').click(function () {
            $('body').toggleClass('light-mode');

            // Toggle button label
            $(this).text(function (_, text) {
                return text === 'üåô Dark Mode' ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
            });
        });
    });

})(jQuery);
